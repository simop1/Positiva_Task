@model List<Positiva_Task.Models.UserModel>

@{
	ViewBag.Title = "User management";
}

<div class="row">
	<h2>@ViewBag.Title</h2>
</div>
<br /><br />
<div class="row">
	<button id="btnCreateUser" type="button" class="btn btn-primary" data-toggle="modal" data-target="#createUserModal">
		<span>Create new user</span>
	</button>
</div>
<br />

<div class="row">
	<table id="usersTable">
		<thead>
			<tr>
				<td>First name</td>
				<td>Last name</td>
				<td>User name</td>
				<td>Email</td>
				<td>Date of birth</td>
				<td>Action</td>
			</tr>
		</thead>
		<tbody>
			@foreach (var item in Model)
			{
				@Html.HiddenFor(model => item.UserID)
				<tr>
					<td>
						@Html.DisplayFor(model => item.FirstName)
					</td>
					<td>
						@Html.DisplayFor(model => item.LastName)
					</td>
					<td>
						@Html.DisplayFor(model => item.UserName)
					</td>
					<td>
						@Html.DisplayFor(model => item.Email)
					</td>
					<td>
						@Html.DisplayFor(model => item.DateOfBirth)
					</td>
					<td>
						<a style="cursor:pointer;" id="edit_@item.UserID" onclick="EditUser(@item.UserID)">Edit</a> |
						<a style="cursor:pointer;" id="delete_@item.UserID" onclick="DeleteUser(@item.UserID)">Delete</a> 

						@*@Html.ActionLink("Edit", "EditOrAddUser", "Home", new { id = item.UserID }) |*@
						@*@Html.ActionLink("Delete", "Delete", { id = item.UserID })*@
					</td>
				</tr>
			}

		</tbody>
	</table>
</div>

<div class="modal fade" id="createUserModal" tabindex="-1" role="dialog" aria-labelledby="createUserModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
		</div>
	</div>
</div>

@section scripts
{
	<script language="JavaScript" type="text/javascript" src="/js/jquery-1.2.6.min.js"></script>
	<script language="JavaScript" type="text/javascript" src="/js/jquery-ui-personalized-1.5.2.packed.js"></script>
	<script language="JavaScript" type="text/javascript" src="/js/sprinkle.js"></script>
	<script src="~/lib/jquery-validation/dist/jquery.validate.js"></script>
	<script src="~/lib/jquery-validation- unobtrusive/jquery.validate.unobtrusive.js"></script>

	@Styles.Render("//cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css")
	@Scripts.Render("//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js")

	<script type="text/javascript">
		$(document).ready(function () {
			$('#usersTable').DataTable({

			});
		});

		var token = $('input[name="__RequestVerificationToken"]').val();

		$("#btnCreateUser").on("click", function(e) {
			//e.preventDefault();
			$.ajax({
				type: "POST",
				datatype: "json",
				contenttype: 'application/json; charset=utf-8',
				url: '@Url.Action("EditOrAddUser", "Home")',
				async: true,
				//method: form.attr("method"),
				//data: form.serialize(),
				data: { UserID: -1 },
				success: function (data) {
					$('#createUserModal .modal-content').html(data);
					$('#createUserModal').modal('show');
				},
				error: function () {
					alert("Failed adding user");
				}
			});
		});

	function EditUser(userID) {
		$.ajax({
			type: "POST",
			datatype: "json",
			contenttype: 'application/json; charset=utf-8',
			url: '@Url.Action("EditOrAddUser", "Home")',
			async: true,
			data: { UserID: JSON.stringify(userID) },
			success: function (data) {
				$('#createUserModal .modal-content').html(data);
				$('#createUserModal').modal('show');
			},
			error: function () {
				alert("Failed adding user");
			}
		});
	}

	function DeleteUser(userID) {

		var deleteUser = confirm("Are you sure you want to delete this user?");
		if (deleteUser == true) {
			$.ajax({
				type: "POST",
				datatype: "json",
				contenttype: 'application/json; charset=utf-8',
				url: '@Url.Action("DeleteUser", "Home")',
				async: true,
				data: { UserID: JSON.stringify(userID) },
				success: function (data) {
					$('#createUserModal .modal-content').html(data);
					$('#createUserModal').modal('show');
				},
				error: function () {
					alert("Failed adding user");
				}
			});
		}
	}
		
	function OnSubmitSuccess(data) {
		debugger
		if (data.Error == true) {
			$('#user-Error').show();
		}
		else {
			$('#createUserModal').modal('hide');
			window.location.reload();
		}
	}

	function OnSubmitFailure(data) {
		debugger
		//$("#productPriceComponentEditModalSubmitButton").attr("disabled", false);
		//$('#productComponentModal').modal('hide');
		alert("Failed adding user");
	}

	</script>
}